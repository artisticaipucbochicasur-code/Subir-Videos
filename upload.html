<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Subir video a DECOM</title>
    <style>
      body {
        margin: 0;
        font-family: "Segoe UI", sans-serif;
        background-color: #f0f4f8;
        color: #333;
      }

      header {
        text-align: center;
      }

      header img {
        width: 100%;
        height: auto;
        display: block;
        object-fit: cover;
        margin-bottom: 0;
      }

      main {
        max-width: 600px;
        margin: 40px auto;
        background-color: #fff;
        border-radius: 12px;
        padding: 40px 30px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        text-align: center;
        font-size: 18px;
      }

      h2 {
        font-size: 32px;
        margin-bottom: 30px;
        color: #2b6cb0;
      }

      input[type="file"] {
        padding: 14px;
        font-size: 18px;
        width: 100%;
        margin-bottom: 25px;
      }

      button {
        padding: 14px 20px;
        font-size: 18px;
        background-color: #2b6cb0;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        transition: background-color 0.3s ease;
      }

      button:hover {
        background-color: #2c5282;
      }

      #copyButton {
        background-color: #38a169;
        margin-top: 15px;
      }

      #copyButton:hover {
        background-color: #2f855a;
      }

      #retryButton {
        background-color: #e53e3e;
        margin-top: 15px;
        display: none;
      }

      #retryButton:hover {
        background-color: #c53030;
      }

      #progressContainer {
        width: 100%;
        margin-top: 25px;
        display: none;
      }

      #progressBar {
        width: 100%;
        height: 22px;
        background-color: #e2e8f0;
        border-radius: 10px;
        overflow: hidden;
      }

      #progress {
        height: 100%;
        width: 0%;
        background-color: #3182ce;
        transition: width 0.3s ease;
      }

      #status {
        margin-top: 25px;
        font-size: 16px;
        color: #444;
      }

      .note {
        font-size: 16px;
        color: #555;
        margin-top: 30px;
        background-color: #edf2f7;
        padding: 20px;
        border-radius: 8px;
        line-height: 1.5;
      }

      a {
        color: #2b6cb0;
        word-break: break-word;
        font-size: 14px;
      }
    </style>
  </head>

  <body>
    <header>
      <img src="logo.png" alt="Logo" />
    </header>

    <main>
      <h2>DECOM - Subir Video</h2>

      <input type="file" id="fileInput" accept="video/*" />
      <button onclick="upload()">üì§ Subir video</button>

      <div id="progressContainer">
        <div id="progressBar">
          <div id="progress"></div>
        </div>
      </div>

      <div id="status"></div>
      <button id="copyButton" onclick="copiar()">üìã Copiar link directo</button>
      <button id="retryButton" onclick="upload()">üîÅ Reintentar</button>

      <div class="note">
        üîÑ Por favor, espera hasta que el video se suba completamente.<br /><br />
        üìã Una vez cargado, copia el link generado y p√©galo en la <strong>descripci√≥n</strong> dentro de la app DECOM.<br /><br />
        ‚úÖ Luego presiona <strong>‚ÄúGuardar Anuncio‚Äù</strong> en la app para finalizar.
      </div>
    </main>

    <script>
      let directLink = "";

      function upload() {
        const file = document.getElementById("fileInput").files[0];
        if (!file) {
          alert("Selecciona un video primero.");
          return;
        }

        document.getElementById("retryButton").style.display = "none";
        document.getElementById("copyButton").style.display = "none";
        document.getElementById("status").innerText = "";

        const identifier = "artistica_bochica_" + Date.now();
        const accessKey = "KPJmAQCm1UyNJWqv";
        const secretKey = "9JkBrIGexGNOynyf";

        const url = `https://s3.us.archive.org/${identifier}/${file.name}`;
        const xhr = new XMLHttpRequest();

        xhr.upload.onprogress = function (event) {
          if (event.lengthComputable) {
            const percent = (event.loaded / event.total) * 100;
            document.getElementById("progressContainer").style.display = "block";
            document.getElementById("progress").style.width = percent + "%";
          }
        };

        xhr.onload = function () {
          if (xhr.status === 200) {
            const fileEncoded = encodeURIComponent(file.name);
            directLink = `https://archive.org/download/${identifier}/${fileEncoded}`;

            document.getElementById("status").innerHTML = `
              <p>‚úÖ Subido correctamente.</p>
              <a href="${directLink}" target="_blank">üîó Ver video</a>`;

            document.getElementById("copyButton").style.display = "inline-block";
            document.getElementById("retryButton").style.display = "none";
          } else {
            document.getElementById("status").innerText = "‚ùå Error al subir: " + xhr.responseText;
            document.getElementById("retryButton").style.display = "inline-block";
          }
        };

        xhr.onerror = function () {
          document.getElementById("status").innerText = "‚ùå Error de red al subir el archivo.";
          document.getElementById("retryButton").style.display = "inline-block";
        };

        xhr.open("PUT", url, true);
        xhr.setRequestHeader("Authorization", `LOW ${accessKey}:${secretKey}`);
        xhr.setRequestHeader("x-archive-auto-make-bucket", "1");
        xhr.setRequestHeader("x-archive-meta-title", file.name);
        xhr.setRequestHeader("x-archive-meta-mediatype", "movies");
        xhr.setRequestHeader("x-archive-meta-description", "Video subido desde la app DECOM");
        xhr.setRequestHeader("x-archive-meta-collection", "opensource_movies");
        xhr.setRequestHeader("x-archive-meta-creator", "artistica_bochica");
        xhr.setRequestHeader("Content-Type", file.type);

        xhr.send(file);
      }

      function copiar() {
        if (!directLink) return;
        navigator.clipboard
          .writeText(directLink)
          .then(() => alert("‚úÖ Link copiado al portapapeles"))
          .catch(() => alert("‚ùå No se pudo copiar"));
      }
    </script>
  </body>
</html>
