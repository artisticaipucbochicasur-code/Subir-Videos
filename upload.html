<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Subir video a DECOM</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f4f4f4;
        padding: 20px;
        text-align: center;
      }

      h2 {
        font-size: 28px;
        margin-bottom: 30px;
        color: #333;
      }

      input[type="file"] {
        padding: 10px;
        font-size: 16px;
        margin-bottom: 15px;
      }

      button {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #2b6cb0;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      button:hover {
        background-color: #2c5282;
      }

      #status {
        margin-top: 20px;
        font-size: 16px;
        color: #444;
      }

      #copyButton {
        display: none;
        margin-top: 15px;
        background-color: #38a169;
      }

      #copyButton:hover {
        background-color: #2f855a;
      }

      #progressContainer {
        width: 100%;
        max-width: 400px;
        margin: 20px auto;
        display: none;
      }

      #progressBar {
        width: 100%;
        height: 20px;
        background-color: #eee;
        border-radius: 10px;
        overflow: hidden;
      }

      #progress {
        height: 100%;
        width: 0%;
        background-color: #3182ce;
        transition: width 0.3s ease;
      }
    </style>
  </head>

  <body>
    <h2>üì§ Subir video a Archive.org (DECOM)</h2>

    <input type="file" id="fileInput" accept="video/*" />
    <br /><br />
    <button onclick="upload()">Subir video</button>

    <div id="progressContainer">
      <div id="progressBar">
        <div id="progress"></div>
      </div>
    </div>

    <div id="status"></div>
    <button id="copyButton" onclick="copiar()">üìã Copiar link directo</button>

    <script>
      let directLink = "";

      function upload() {
        const file = document.getElementById("fileInput").files[0];
        if (!file) {
          alert("Selecciona un video primero.");
          return;
        }

        const identifier = "artistica_bochica_" + Date.now();
        const accessKey = "KPJmAQCm1UyNJWqv";
        const secretKey = "9JkBrIGexGNOynyf";

        const url = `https://s3.us.archive.org/${identifier}/${file.name}`;
        const xhr = new XMLHttpRequest();

        xhr.upload.onprogress = function (event) {
          if (event.lengthComputable) {
            const percent = (event.loaded / event.total) * 100;
            document.getElementById("progressContainer").style.display = "block";
            document.getElementById("progress").style.width = percent + "%";
          }
        };

        xhr.onload = function () {
          if (xhr.status === 200) {
            const fileEncoded = encodeURIComponent(file.name);
            directLink = `https://archive.org/download/${identifier}/${fileEncoded}`;

            document.getElementById("status").innerHTML = `
              <p>‚úÖ Subido correctamente.</p>
              <a href="${directLink}" target="_blank">${directLink}</a>
            `;
            document.getElementById("copyButton").style.display = "inline-block";
          } else {
            document.getElementById("status").innerText = "‚ùå Error al subir: " + xhr.responseText;
          }
        };

        xhr.onerror = function () {
          document.getElementById("status").innerText = "‚ùå Error de red al subir el archivo.";
        };

        xhr.open("PUT", url, true);
        xhr.setRequestHeader("Authorization", `LOW ${accessKey}:${secretKey}`);
        xhr.setRequestHeader("x-archive-auto-make-bucket", "1");
        xhr.setRequestHeader("x-archive-meta-title", file.name);
        xhr.setRequestHeader("x-archive-meta-mediatype", "movies");
        xhr.setRequestHeader("x-archive-meta-description", "Video subido desde la app DECOM");
        xhr.setRequestHeader("x-archive-meta-collection", "opensource_movies");
        xhr.setRequestHeader("x-archive-meta-creator", "artistica_bochica");
        xhr.setRequestHeader("Content-Type", file.type);

        xhr.send(file);
      }

      function copiar() {
        if (!directLink) return;
        navigator.clipboard
          .writeText(directLink)
          .then(() => alert("‚úÖ Link copiado al portapapeles"))
          .catch(() => alert("‚ùå No se pudo copiar"));
      }
    </script>
  </body>
</html>
