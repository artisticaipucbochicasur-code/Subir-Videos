<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Subir video a Archive.org - DECOM</title>
    <style>
      body { font-family: sans-serif; padding: 20px; }
      #copyButton {
        display: none;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h2>Subir video a DECOM </h2>
    <input type="file" id="fileInput" accept="video/*" />
    <br><br>
    <button onclick="upload()">üì§ Subir video</button>
    <div id="status"></div>
    <button id="copyButton" onclick="copiar()">üìã Copiar link directo</button>

    <script>
      let directLink = "";

      async function upload() {
        const file = document.getElementById("fileInput").files[0];
        if (!file) {
          alert("Selecciona un video primero.");
          return;
        }

        const identifier = "artistica_bochica_" + Date.now();
        const accessKey = "KPJmAQCm1UyNJWqv";
        const secretKey = "9JkBrIGexGNOynyf";

        const url = `https://s3.us.archive.org/${identifier}/${file.name}`;

        const response = await fetch(url, {
          method: "PUT",
          body: file,
          headers: {
            Authorization: `LOW ${accessKey}:${secretKey}`,
            "x-archive-auto-make-bucket": "1",
            "x-archive-meta-title": file.name,
            "x-archive-meta-mediatype": "movies",
            "x-archive-meta-description": "Video subido desde la app DECOM",
            "x-archive-meta-collection": "opensource_movies",
            "x-archive-meta-creator": "artistica_bochica",
            "Content-Type": file.type
          }
        });

        if (response.ok) {
          const fileEncoded = encodeURIComponent(file.name);
          directLink = `https://archive.org/download/${identifier}/${fileEncoded}`;

          document.getElementById("status").innerHTML = `
            <p>‚úÖ Subido correctamente.</p>
            <p>üé• <a href="${directLink}" target="_blank">${directLink}</a></p>
          `;
          document.getElementById("copyButton").style.display = "inline-block";
        } else {
          const errorText = await response.text();
          document.getElementById("status").innerHTML = `<p>‚ùå Error: ${errorText}</p>`;
        }
      }

      function copiar() {
        if (!directLink) return;
        navigator.clipboard.writeText(directLink)
          .then(() => alert("‚úÖ Link directo copiado al portapapeles"))
          .catch(() => alert("‚ùå No se pudo copiar"));
      }
    </script>
  </body>
</html>
