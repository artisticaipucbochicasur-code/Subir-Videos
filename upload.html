<div><br class="Apple-interchange-newline"><!DOCTYPE html><br><html lang="es"><br> <head><br> <meta charset="UTF-8" /><br> <meta name="viewport" content="width=device-width, initial-scale=1.0" /><br> <title>Subir video a DECOM</title><br> <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet" /><br> <style><br> /* ... mismos estilos ... */<br> * { box-sizing: border-box; }<br> body { margin: 0; font-family: "Segoe UI", sans-serif; background-color: #f0f4f8; color: #333; position: relative; padding-top: 160px; }<br> .logo-container { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 100%; max-height: 200px; z-index: 2; text-align: center; background-color: transparent; }<br> .logo-container img { max-width: 100%; height: auto; object-fit: contain; }<br> main { max-width: 1200px; width: 95%; margin: 0 auto; background-color: #fff; border-radius: 14px; padding: 30px 25px; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); text-align: center; position: relative; z-index: 1; }<br> h2 { font-family: 'Luckiest Guy', cursive; font-size: 36px; margin-bottom: 30px; color: #2b6cb0; }<br> .input-group { margin-bottom: 20px; text-align: left; }<br> label { display: block; margin-bottom: 8px; font-weight: bold; color: #2b6cb0; font-size: 18px; }<br> input[type="file"] { padding: 18px; font-size: 18px; width: 100%; border-radius: 10px; margin-bottom: 20px; border: 2px dashed #90cdf4; background-color: #ebf8ff; }<br> input[type="text"] { padding: 16px; font-size: 18px; width: 100%; border-radius: 10px; border: 2px solid #90cdf4; background-color: #ebf8ff; margin-bottom: 10px; box-sizing: border-box; }<br> input[type="text"]:required { border-color: #e53e3e; }<br> button { padding: 16px 24px; font-size: 20px; background-color: #2b6cb0; color: white; border: none; border-radius: 10px; cursor: pointer; width: 100%; margin-bottom: 15px; transition: background-color 0.3s ease, transform 0.2s ease; }<br> button:hover { background-color: #2c5282; transform: scale(1.02); }<br> #copyButton { background-color: #38a169; }<br> #copyButton:hover { background-color: #2f855a; }<br> #retryButton { background-color: #e53e3e; display: none; }<br> #retryButton:hover { background-color: #c53030; }<br> #deleteButton { background-color: #d53f8c; }<br> #deleteButton:hover { background-color: #b83280; }<br> #deleteArea { margin-bottom: 20px; }<br> #progressContainer { width: 100%; margin-top: 20px; display: none; }<br> #progressBar { width: 100%; height: 20px; background-color: #e2e8f0; border-radius: 10px; overflow: hidden; }<br> #progress { height: 100%; width: 0%; background-color: #3182ce; transition: width 0.3s ease; }<br> #status { margin-top: 20px; font-size: 16px; color: #444; }<br> .note { font-size: 16px; color: #555; margin-top: 30px; background-color: #edf2f7; padding: 20px; border-radius: 10px; line-height: 1.6; }<br> a { color: #2b6cb0; word-break: break-word; font-size: 14px; }<br> select { padding: 12px; font-size: 16px; border-radius: 8px; border: 2px solid #90cdf4; margin-bottom: 10px; width: 100%; max-width: 400px; }<br> @media (max-width: 600px) {<br> body { padding-top: 140px; }<br> h2 { font-size: 28px; }<br> input[type="file"], input[type="text"], button, select { font-size: 16px; padding: 14px; }<br> .note { font-size: 14px; }<br> label { font-size: 16px; }<br> }<br> </style><br> </head><br> <body><br> <div class="logo-container"><br> <img src="logo.png" alt="Logo" /><br> </div><br> <main><br> <h2>DECOM BOCHICA SUR</h2><br> <form id="uploadForm" onsubmit="event.preventDefault(); upload();"><br> <div class="input-group"><br> <label for="videoTitle">T√≠tulo del video <span style="color: #e53e3e">*</span></label><br> <input type="text" id="videoTitle" placeholder="Escribe el t√≠tulo del video" maxlength="80" required /><br> </div><br> <input type="file" id="fileInput" accept="video/*" required /><br> <button type="submit">üì§ Subir video</button><br> </form><br> <div id="progressContainer"><br> <div id="progressBar"><br> <div id="progress"></div><br> </div><br> </div><br> <div id="status"></div><br> <button id="copyButton" onclick="copiar()">üìã Copiar link directo</button><br> <button id="retryButton" onclick="upload()">üîÅ Reintentar</button><br> <div id="deleteArea"><br> <select id="deleteSelect"><br> <option value="">Selecciona una publicaci√≥n para eliminar</option><br> </select><br> <button id="deleteButton" onclick="eliminarSeleccionada()">üóëÔ∏è Eliminar publicaci√≥n</button><br> </div><br> <div class="note"><br> üîÑ Por favor, espera hasta que el video se suba completamente.<br /><br /><br> üìã El link ser√° guardado autom√°ticamente en la hoja de c√°lculo.<br /><br /><br> ‚úÖ Luego presiona <strong>‚ÄúPublivar Video‚Äù</strong> en la app para finalizar.<br /><br /><br> Desarrollada por: DEIMER HERRERA.<br> </div><br> </main><br> <script><br> let directLink = "";<br> let identifier = "";<br> let fileName = "";<br> let tituloUsuario = "";<br><br> document.addEventListener("DOMContentLoaded", cargarPublicaciones);<br><br> function cargarPublicaciones() {<br> // Obtiene la lista de publicaciones desde el Apps Script<br> fetch('https://script.google.com/macros/s/AKfycbwyY6m3H8WD494cnoQbNXwspsZtD1sGu97yio9mk9DTozGSuyo6gHXB1W6HArcpYfP2/exec?accion=listar')<br> .then(response => response.json())<br> .then(data => {<br> const select = document.getElementById("deleteSelect");<br> select.innerHTML = '<option value="">Selecciona una publicaci√≥n para eliminar</option>';<br> if (Array.isArray(data.publicaciones)) {<br> data.publicaciones.forEach(pub => {<br> // pub: {titulo, link}<br> select.innerHTML += `<option value="${pub.link}">${pub.titulo}</option>`;<br> });<br> }<br> });<br> }<br><br> function upload() {<br> const file = document.getElementById("fileInput").files[0];<br> tituloUsuario = document.getElementById("videoTitle").value.trim();<br><br> if (!file) {<br> alert("Selecciona un video primero.");<br> document.getElementById("fileInput").focus();<br> return;<br> }<br><br> if (!tituloUsuario) {<br> alert("Por favor, escribe el t√≠tulo del video.");<br> document.getElementById("videoTitle").focus();<br> return;<br> }<br><br> document.getElementById("retryButton").style.display = "none";<br> document.getElementById("copyButton").style.display = "none";<br> document.getElementById("status").innerText = "";<br><br> identifier = "artistica_bochica_" + Date.now();<br> fileName = file.name;<br> const accessKey = "KPJmAQCm1UyNJWqv";<br> const secretKey = "9JkBrIGexGNOynyf";<br><br> const url = `https://s3.us.archive.org/${identifier}/${fileName}`;<br> const xhr = new XMLHttpRequest();<br><br> xhr.upload.onprogress = function (event) {<br> if (event.lengthComputable) {<br> const percent = (event.loaded / event.total) * 100;<br> document.getElementById("progressContainer").style.display = "block";<br> document.getElementById("progress").style.width = percent + "%";<br> }<br> };<br><br> xhr.onload = function () {<br> if (xhr.status === 200) {<br> const fileEncoded = encodeURIComponent(fileName);<br> directLink = `https://archive.org/download/${identifier}/${fileEncoded}`;<br> document.getElementById("status").innerHTML = `<br> <p>‚úÖ Publicaci√≥n exitosa.</p><br> <a href="${directLink}" target="_blank">üîó Ver video</a>`;<br> document.getElementById("copyButton").style.display = "inline-block";<br> document.getElementById("retryButton").style.display = "none";<br><br> // Guardar en hoja de c√°lculo<br> fetch('https://script.google.com/macros/s/AKfycbwyY6m3H8WD494cnoQbNXwspsZtD1sGu97yio9mk9DTozGSuyo6gHXB1W6HArcpYfP2/exec?accion=guardar&tipo=video&titulo='<br> + encodeURIComponent(tituloUsuario)<br> + '&link=' + encodeURIComponent(directLink), {<br> method: 'GET'<br> }).then(cargarPublicaciones);<br><br> } else {<br> document.getElementById("status").innerText = "‚ùå Error al subir: " + xhr.responseText;<br> document.getElementById("retryButton").style.display = "inline-block";<br> }<br> };<br><br> xhr.onerror = function () {<br> document.getElementById("status").innerText = "‚ùå Error de red al subir el archivo.";<br> document.getElementById("retryButton").style.display = "inline-block";<br> };<br><br> xhr.open("PUT", url, true);<br> xhr.setRequestHeader("Authorization", `LOW ${accessKey}:${secretKey}`);<br> xhr.setRequestHeader("x-archive-auto-make-bucket", "1");<br> xhr.setRequestHeader("x-archive-meta-title", fileName);<br> xhr.setRequestHeader("x-archive-meta-mediatype", "movies");<br> xhr.setRequestHeader("x-archive-meta-description", "Video subido desde la app DECOM");<br> xhr.setRequestHeader("x-archive-meta-collection", "opensource_movies");<br> xhr.setRequestHeader("x-archive-meta-creator", "artistica_bochica");<br> xhr.setRequestHeader("Content-Type", file.type);<br><br> xhr.send(file);<br> }<br><br> function copiar() {<br> if (!directLink) return;<br> navigator.clipboard<br> .writeText(directLink)<br> .then(() => alert("‚úÖ Link copiado al portapapeles"))<br> .catch(() => alert("‚ùå No se pudo copiar"));<br> }<br><br> function eliminarSeleccionada() {<br> const select = document.getElementById("deleteSelect");<br> const link = select.value;<br> const titulo = select.options[select.selectedIndex]?.text;<br><br> if (!link) {<br> alert("Selecciona una publicaci√≥n para eliminar.");<br> return;<br> }<br><br> // Eliminar de Archive.org<br> let archiveMatch = link.match(/archive\.org\/download\/(artistica_bochica_\d+)\/(.+)$/);<br> if (!archiveMatch) {<br> alert("No se pudo encontrar la ruta del archivo en Archive.org.");<br> return;<br> }<br> let delIdentifier = archiveMatch[1];<br> let delFileName = decodeURIComponent(archiveMatch[2]);<br><br> const url = `https://s3.us.archive.org/${delIdentifier}/${delFileName}`;<br> const accessKey = "KPJmAQCm1UyNJWqv";<br> const secretKey = "9JkBrIGexGNOynyf";<br> const xhr = new XMLHttpRequest();<br><br> xhr.open("DELETE", url, true);<br> xhr.setRequestHeader("Authorization", `LOW ${accessKey}:${secretKey}`);<br><br> xhr.onload = function () {<br> if (xhr.status === 200 || xhr.status === 204) {<br> document.getElementById("status").innerHTML = `<p>üóëÔ∏è Publicaci√≥n eliminada de Archive.org.</p>`;<br> // Eliminar de hoja de c√°lculo<br> fetch('https://script.google.com/macros/s/AKfycbwyY6m3H8WD494cnoQbNXwspsZtD1sGu97yio9mk9DTozGSuyo6gHXB1W6HArcpYfP2/exec?accion=eliminar&link='<br> + encodeURIComponent(link), {<br> method: 'GET'<br> }).then(cargarPublicaciones);<br> select.selectedIndex = 0;<br> } else {<br> document.getElementById("status").innerHTML += "<br>‚ö†Ô∏è Error al eliminar de Archive.org.";<br> }<br> };<br><br> xhr.onerror = function () {<br> document.getElementById("status").innerHTML += "<br>‚ö†Ô∏è Error de red al eliminar de Archive.org.";<br> };<br><br> xhr.send();<br> }<br><br> </script><br> </body><br></html><br><br><br id="textarea-placeholder-break"></div> y este otro es el script function doGet(e) {

¬† return handleRequest(e);

}

