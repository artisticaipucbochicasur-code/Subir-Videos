<!DOCTYPE html>

<html lang="es">

Â  <head>

Â  Â  <meta charset="UTF-8" />

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

Â  Â  <title>Subir video a DECOM</title>

Â  Â  <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet" />

Â  Â  <style>

Â  Â  Â  /* ... mismos estilos ... */

Â  Â  Â  * { box-sizing: border-box; }

Â  Â  Â  body { margin: 0; font-family: "Segoe UI", sans-serif; background-color: #f0f4f8; color: #333; position: relative; padding-top: 160px; }

Â  Â  Â  .logo-container { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 100%; max-height: 200px; z-index: 2; text-align: center; background-color: transparent; }

Â  Â  Â  .logo-container img { max-width: 100%; height: auto; object-fit: contain; }

Â  Â  Â  main { max-width: 1200px; width: 95%; margin: 0 auto; background-color: #fff; border-radius: 14px; padding: 30px 25px; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); text-align: center; position: relative; z-index: 1; }

Â  Â  Â  h2 { font-family: 'Luckiest Guy', cursive; font-size: 36px; margin-bottom: 30px; color: #2b6cb0; }

Â  Â  Â  .input-group { margin-bottom: 20px; text-align: left; }

Â  Â  Â  label { display: block; margin-bottom: 8px; font-weight: bold; color: #2b6cb0; font-size: 18px; }

Â  Â  Â  input[type="file"] { padding: 18px; font-size: 18px; width: 100%; border-radius: 10px; margin-bottom: 20px; border: 2px dashed #90cdf4; background-color: #ebf8ff; }

Â  Â  Â  input[type="text"] { padding: 16px; font-size: 18px; width: 100%; border-radius: 10px; border: 2px solid #90cdf4; background-color: #ebf8ff; margin-bottom: 10px; box-sizing: border-box; }

Â  Â  Â  input[type="text"]:required { border-color: #e53e3e; }

Â  Â  Â  button { padding: 16px 24px; font-size: 20px; background-color: #2b6cb0; color: white; border: none; border-radius: 10px; cursor: pointer; width: 100%; margin-bottom: 15px; transition: background-color 0.3s ease, transform 0.2s ease; }

Â  Â  Â  button:hover { background-color: #2c5282; transform: scale(1.02); }

Â  Â  Â  #copyButton { background-color: #38a169; }

Â  Â  Â  #copyButton:hover { background-color: #2f855a; }

Â  Â  Â  #retryButton { background-color: #e53e3e; display: none; }

Â  Â  Â  #retryButton:hover { background-color: #c53030; }

Â  Â  Â  #deleteButton { background-color: #d53f8c; }

Â  Â  Â  #deleteButton:hover { background-color: #b83280; }

Â  Â  Â  #deleteArea { margin-bottom: 20px; }

Â  Â  Â  #progressContainer { width: 100%; margin-top: 20px; display: none; }

Â  Â  Â  #progressBar { width: 100%; height: 20px; background-color: #e2e8f0; border-radius: 10px; overflow: hidden; }

Â  Â  Â  #progress { height: 100%; width: 0%; background-color: #3182ce; transition: width 0.3s ease; }

Â  Â  Â  #status { margin-top: 20px; font-size: 16px; color: #444; }

Â  Â  Â  .note { font-size: 16px; color: #555; margin-top: 30px; background-color: #edf2f7; padding: 20px; border-radius: 10px; line-height: 1.6; }

Â  Â  Â  a { color: #2b6cb0; word-break: break-word; font-size: 14px; }

Â  Â  Â  select { padding: 12px; font-size: 16px; border-radius: 8px; border: 2px solid #90cdf4; margin-bottom: 10px; width: 100%; max-width: 400px; }

Â  Â  Â  @media (max-width: 600px) {

Â  Â  Â  Â  body { padding-top: 140px; }

Â  Â  Â  Â  h2 { font-size: 28px; }

Â  Â  Â  Â  input[type="file"], input[type="text"], button, select { font-size: 16px; padding: 14px; }

Â  Â  Â  Â  .note { font-size: 14px; }

Â  Â  Â  Â  label { font-size: 16px; }

Â  Â  Â  }

Â  Â  </style>

Â  </head>

Â  <body>

Â  Â  <div class="logo-container">

Â  Â  Â  <img src="logo.png" alt="Logo" />

Â  Â  </div>

Â  Â  <main>

Â  Â  Â  <h2>DECOM BOCHICA SUR</h2>

Â  Â  Â  <form id="uploadForm" onsubmit="event.preventDefault(); upload();">

Â  Â  Â  Â  <div class="input-group">

Â  Â  Â  Â  Â  <label for="videoTitle">TÃ­tulo del video <span style="color: #e53e3e">*</span></label>

Â  Â  Â  Â  Â  <input type="text" id="videoTitle" placeholder="Escribe el tÃ­tulo del video" maxlength="80" required />

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <input type="file" id="fileInput" accept="video/*" required />

Â  Â  Â  Â  <button type="submit">ğŸ“¤ Subir video</button>

Â  Â  Â  </form>

Â  Â  Â  <div id="progressContainer">

Â  Â  Â  Â  <div id="progressBar">

Â  Â  Â  Â  Â  <div id="progress"></div>

Â  Â  Â  Â  </div>

Â  Â  Â  </div>

Â  Â  Â  <div id="status"></div>

Â  Â  Â  <button id="copyButton" onclick="copiar()">ğŸ“‹ Copiar link directo</button>

Â  Â  Â  <button id="retryButton" onclick="upload()">ğŸ” Reintentar</button>

Â  Â  Â  <div id="deleteArea">

Â  Â  Â  Â  <select id="deleteSelect">

Â  Â  Â  Â  Â  <option value="">Selecciona una publicaciÃ³n para eliminar</option>

Â  Â  Â  Â  </select>

Â  Â  Â  Â  <button id="deleteButton" onclick="eliminarSeleccionada()">ğŸ—‘ï¸ Eliminar publicaciÃ³n</button>

Â  Â  Â  </div>

Â  Â  Â  <div class="note">

Â  Â  Â  Â  ğŸ”„ Por favor, espera hasta que el video se suba completamente.<br /><br />

Â  Â  Â  Â  ğŸ“‹ El link serÃ¡ guardado automÃ¡ticamente en la hoja de cÃ¡lculo.<br /><br />

Â  Â  Â  Â  âœ… Luego presiona <strong>â€œPublivar Videoâ€</strong> en la app para finalizar.<br /><br />

Â  Â  Â  Â  Desarrollada por: DEIMER HERRERA.

Â  Â  Â  </div>

Â  Â  </main>

Â  Â  <script>

Â  Â  Â  let directLink = "";

Â  Â  Â  let identifier = "";

Â  Â  Â  let fileName = "";

Â  Â  Â  let tituloUsuario = "";



Â  Â  Â  document.addEventListener("DOMContentLoaded", cargarPublicaciones);



Â  Â  Â  function cargarPublicaciones() {

Â  Â  Â  Â  // Obtiene la lista de publicaciones desde el Apps Script

Â  Â  Â  Â  fetch('https://script.google.com/macros/s/AKfycbwyY6m3H8WD494cnoQbNXwspsZtD1sGu97yio9mk9DTozGSuyo6gHXB1W6HArcpYfP2/exec?accion=listar')

Â  Â  Â  Â  Â  .then(response => response.json())

Â  Â  Â  Â  Â  .then(data => {

Â  Â  Â  Â  Â  Â  const select = document.getElementById("deleteSelect");

Â  Â  Â  Â  Â  Â  select.innerHTML = '<option value="">Selecciona una publicaciÃ³n para eliminar</option>';

Â  Â  Â  Â  Â  Â  if (Array.isArray(data.publicaciones)) {

Â  Â  Â  Â  Â  Â  Â  data.publicaciones.forEach(pub => {

Â  Â  Â  Â  Â  Â  Â  Â  // pub: {titulo, link}

Â  Â  Â  Â  Â  Â  Â  Â  select.innerHTML += `<option value="${pub.link}">${pub.titulo}</option>`;

Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  });

Â  Â  Â  }



Â  Â  Â  function upload() {

Â  Â  Â  Â  const file = document.getElementById("fileInput").files[0];

Â  Â  Â  Â  tituloUsuario = document.getElementById("videoTitle").value.trim();



Â  Â  Â  Â  if (!file) {

Â  Â  Â  Â  Â  alert("Selecciona un video primero.");

Â  Â  Â  Â  Â  document.getElementById("fileInput").focus();

Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  }



Â  Â  Â  Â  if (!tituloUsuario) {

Â  Â  Â  Â  Â  alert("Por favor, escribe el tÃ­tulo del video.");

Â  Â  Â  Â  Â  document.getElementById("videoTitle").focus();

Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  }



Â  Â  Â  Â  document.getElementById("retryButton").style.display = "none";

Â  Â  Â  Â  document.getElementById("copyButton").style.display = "none";

Â  Â  Â  Â  document.getElementById("status").innerText = "";



Â  Â  Â  Â  identifier = "artistica_bochica_" + Date.now();

Â  Â  Â  Â  fileName = file.name;

Â  Â  Â  Â  const accessKey = "KPJmAQCm1UyNJWqv";

Â  Â  Â  Â  const secretKey = "9JkBrIGexGNOynyf";



Â  Â  Â  Â  const url = `https://s3.us.archive.org/${identifier}/${fileName}`;

Â  Â  Â  Â  const xhr = new XMLHttpRequest();



Â  Â  Â  Â  xhr.upload.onprogress = function (event) {

Â  Â  Â  Â  Â  if (event.lengthComputable) {

Â  Â  Â  Â  Â  Â  const percent = (event.loaded / event.total) * 100;

Â  Â  Â  Â  Â  Â  document.getElementById("progressContainer").style.display = "block";

Â  Â  Â  Â  Â  Â  document.getElementById("progress").style.width = percent + "%";

Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };



Â  Â  Â  Â  xhr.onload = function () {

Â  Â  Â  Â  Â  if (xhr.status === 200) {

Â  Â  Â  Â  Â  Â  const fileEncoded = encodeURIComponent(fileName);

Â  Â  Â  Â  Â  Â  directLink = `https://archive.org/download/${identifier}/${fileEncoded}`;

Â  Â  Â  Â  Â  Â  document.getElementById("status").innerHTML = `

Â  Â  Â  Â  Â  Â  Â  <p>âœ… PublicaciÃ³n exitosa.</p>

Â  Â  Â  Â  Â  Â  Â  <a href="${directLink}" target="_blank">ğŸ”— Ver video</a>`;

Â  Â  Â  Â  Â  Â  document.getElementById("copyButton").style.display = "inline-block";

Â  Â  Â  Â  Â  Â  document.getElementById("retryButton").style.display = "none";



Â  Â  Â  Â  Â  Â  // Guardar en hoja de cÃ¡lculo

Â  Â  Â  Â  Â  Â  fetch('https://script.google.com/macros/s/AKfycbwyY6m3H8WD494cnoQbNXwspsZtD1sGu97yio9mk9DTozGSuyo6gHXB1W6HArcpYfP2/exec?accion=guardar&tipo=video&titulo='

Â  Â  Â  Â  Â  Â  Â  + encodeURIComponent(tituloUsuario)

Â  Â  Â  Â  Â  Â  Â  + '&link=' + encodeURIComponent(directLink), {

Â  Â  Â  Â  Â  Â  Â  method: 'GET'

Â  Â  Â  Â  Â  Â  }).then(cargarPublicaciones);



Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  document.getElementById("status").innerText = "âŒ Error al subir: " + xhr.responseText;

Â  Â  Â  Â  Â  Â  document.getElementById("retryButton").style.display = "inline-block";

Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };



Â  Â  Â  Â  xhr.onerror = function () {

Â  Â  Â  Â  Â  document.getElementById("status").innerText = "âŒ Error de red al subir el archivo.";

Â  Â  Â  Â  Â  document.getElementById("retryButton").style.display = "inline-block";

Â  Â  Â  Â  };



Â  Â  Â  Â  xhr.open("PUT", url, true);

Â  Â  Â  Â  xhr.setRequestHeader("Authorization", `LOW ${accessKey}:${secretKey}`);

Â  Â  Â  Â  xhr.setRequestHeader("x-archive-auto-make-bucket", "1");

Â  Â  Â  Â  xhr.setRequestHeader("x-archive-meta-title", fileName);

Â  Â  Â  Â  xhr.setRequestHeader("x-archive-meta-mediatype", "movies");

Â  Â  Â  Â  xhr.setRequestHeader("x-archive-meta-description", "Video subido desde la app DECOM");

Â  Â  Â  Â  xhr.setRequestHeader("x-archive-meta-collection", "opensource_movies");

Â  Â  Â  Â  xhr.setRequestHeader("x-archive-meta-creator", "artistica_bochica");

Â  Â  Â  Â  xhr.setRequestHeader("Content-Type", file.type);



Â  Â  Â  Â  xhr.send(file);

Â  Â  Â  }



Â  Â  Â  function copiar() {

Â  Â  Â  Â  if (!directLink) return;

Â  Â  Â  Â  navigator.clipboard

Â  Â  Â  Â  Â  .writeText(directLink)

Â  Â  Â  Â  Â  .then(() => alert("âœ… Link copiado al portapapeles"))

Â  Â  Â  Â  Â  .catch(() => alert("âŒ No se pudo copiar"));

Â  Â  Â  }



Â  Â  Â  Â function eliminarSeleccionada() {

Â  Â  Â  Â  const select = document.getElementById("deleteSelect");

Â  Â  Â  Â  const link = select.value;

Â  Â  Â  Â  const titulo = select.options[select.selectedIndex]?.text;



Â  Â  Â  Â  if (!link) {

Â  Â  Â  Â  Â  alert("Selecciona una publicaciÃ³n para eliminar.");

Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  }



Â  Â  Â  Â  // Eliminar de Archive.org

Â  Â  Â  Â  let archiveMatch = link.match(/archive\.org\/download\/(artistica_bochica_\d+)\/(.+)$/);

Â  Â  Â  Â  if (!archiveMatch) {

Â  Â  Â  Â  Â  alert("No se pudo encontrar la ruta del archivo en Archive.org.");

Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  }

Â  Â  Â  Â  let delIdentifier = archiveMatch[1];

Â  Â  Â  Â  let delFileName = decodeURIComponent(archiveMatch[2]);



Â  Â  Â  Â  const url = `https://s3.us.archive.org/${delIdentifier}/${delFileName}`;

Â  Â  Â  Â  const accessKey = "KPJmAQCm1UyNJWqv";

Â  Â  Â  Â  const secretKey = "9JkBrIGexGNOynyf";

Â  Â  Â  Â  const xhr = new XMLHttpRequest();



Â  Â  Â  Â  xhr.open("DELETE", url, true);

Â  Â  Â  Â  xhr.setRequestHeader("Authorization", `LOW ${accessKey}:${secretKey}`);



Â  Â  Â  Â  xhr.onload = function () {

Â  Â  Â  Â  Â  if (xhr.status === 200 || xhr.status === 204) {

Â  Â  Â  Â  Â  Â  document.getElementById("status").innerHTML = `<p>ğŸ—‘ï¸ PublicaciÃ³n eliminada de Archive.org.</p>`;

Â  Â  Â  Â  Â  Â  // Eliminar de hoja de cÃ¡lculo

Â  Â  Â  Â  Â  Â  fetch('https://script.google.com/macros/s/AKfycbwyY6m3H8WD494cnoQbNXwspsZtD1sGu97yio9mk9DTozGSuyo6gHXB1W6HArcpYfP2/exec?accion=eliminar&link='

Â  Â  Â  Â  Â  Â  Â  + encodeURIComponent(link), {

Â  Â  Â  Â  Â  Â  Â  method: 'GET'

Â  Â  Â  Â  Â  Â  }).then(cargarPublicaciones);

Â  Â  Â  Â  Â  Â  select.selectedIndex = 0;

Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  document.getElementById("status").innerHTML += "<br>âš ï¸ Error al eliminar de Archive.org.";

Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };



Â  Â  Â  Â  xhr.onerror = function () {

Â  Â  Â  Â  Â  document.getElementById("status").innerHTML += "<br>âš ï¸ Error de red al eliminar de Archive.org.";

Â  Â  Â  Â  };



Â  Â  Â  Â  xhr.send();

Â  Â  Â  }



Â  Â  </script>

Â  </body>

</html> mira este es el script donde esta lo que manda a app inventor para que lo tomes de ejemplo que si funciona y el que lista en el html // NUEVA FUNCIÃ“N PARA EL HTML

Â  Â  if (accion === "listarWeb") {

Â  Â  Â  const datos = hojaVideos.getDataRange().getValues();

Â  Â  Â  if (datos.length < 2) {

Â  Â  Â  Â  return ContentService.createTextOutput(JSON.stringify({ status: "success", publicaciones: [] })).setMimeType(ContentService.MimeType.JSON);

Â  Â  Â  }

Â  Â  Â 

Â  Â  Â  const encabezados = datos[0];

Â  Â  Â  const publicaciones = datos.slice(1).map(row => {

Â  Â  Â  Â  Â  let obj = {};

Â  Â  Â  Â  Â  for (let i = 0; i < encabezados.length; i++) {

Â  Â  Â  Â  Â  Â  Â  obj[encabezados[i].toLowerCase()] = row[i];

Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  return obj;

Â  Â  Â  });

Â  Â  Â  return ContentService.createTextOutput(JSON.stringify({ status: "success", publicaciones: publicaciones })).setMimeType(ContentService.MimeType.JSON);

Â  Â  }

Â  Â 

Â  Â  // LISTAR ANUNCIOS O VIDEOS

Â  Â  if (accion === "listar") {

Â  Â  Â  const hoja = (tipo === "videos") ? hojaVideos : hojaAnuncios;

Â  Â  Â  if (!hoja) {

Â  Â  Â  Â  return ContentService.createTextOutput(JSON.stringify({ status: "error", message: `No se encontrÃ³ la hoja para el tipo '${tipo}'` })).setMimeType(ContentService.MimeType.JSON);

Â  Â  Â  }

Â  Â  Â 

Â  Â  Â  const datos = hoja.getDataRange().getValues();

Â  Â  Â  if (datos.length < 2) {

Â  Â  Â  Â  return ContentService.createTextOutput(JSON.stringify({ status: "success", data: [] })).setMimeType(ContentService.MimeType.JSON);

Â  Â  Â  }

Â  Â  Â 

Â  Â  Â  const contenido = datos.slice(1);

Â  Â  Â  return ContentService.createTextOutput(JSON.stringify({ status: "success", data: contenido })).setMimeType(ContentService.MimeType.JSON);

Â  Â  }
